name: ci

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  build-and-test:
    uses: ./.github/workflows/ziggy-shared-ci.yml
    with:
      verify_script: |
        if grep -qE '\.path = "\.\./Ziggy' build.zig.zon; then
          echo "Local path Ziggy dependencies are not allowed in CI"
          exit 1
        fi
        grep -q 'ziggy_spider_protocol' build.zig.zon
        grep -q 'ziggy_memory_store' build.zig.zon
        grep -q 'ziggy_tool_runtime' build.zig.zon
        grep -q 'ziggy_runtime_hooks' build.zig.zon
        grep -q 'ziggy_run_orchestrator' build.zig.zon
        grep -q '\.hash =' build.zig.zon
